<%= stylesheet_link_tag 'post_show', :media => "all" %>



<html>
<head>
<link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/css/lightbox.css" rel="stylesheet">
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.7.1/js/lightbox.min.js" type="text/javascript"></script>
</head>
<body>
<%= yield %>
<div class="title">
<% provide(:title, '詳細情報') %>
<h1>詳細情報</h1>
</div>

<div class="mainbox">
<div class="post_show">
  <div class="post_shousai">
  <div class="post_tyuuou">
    <h2><p><%= link_to User.find(@post.user_id).name, user_path(@post.user_id) %></p></h2>
    <h2><p><%= @post.name1 %></p></h2>
    <p>【<%= Prefecture.find(@post.prefecture_id).name %>】</p>
    <p>公演日 <%= @post.start_time.strftime("%-m/%-d(%a.)") %></p>
    <p>開演時間 <%= @post.start_time.strftime("%-H:%M") %></p>
    
    <% if @post.image.present? %>

      <p><%= safe_join(@post.detail.split("\n"),tag(:br)) %></p>

      <div class="gazou">
        <%= link_to @post.image_url, "data-lightbox" => @post.image_url do %>
          <p><%= image_tag @post.image_url, size: "210x297" if @post.image? %>
        <% end %>
        <% if  @post.image2.present? %>
          <%= link_to @post.image2_url, "data-lightbox" => @post.image2_url do %>
            <%= image_tag @post.image2_url, size: "210x297" if @post.image? %></p> 
          <% end %>
        <% end %>
      </div>
    <% else %>
      <p><%= safe_join(@post.detail.split("\n"),tag(:br)) %></p>
      <p> <%= @post.music %> </p>     
    <% end %>

    <% if user_signed_in? && current_user.id == @post.user_id || user_signed_in? && current_user.id==1%>  
     <%= link_to "編集する", edit_post_path(@post.id) %>
      <%= button_to "削除する", post_path(@post.id), method: :delete %>
    <% end %>
   
    <div id="likes_buttons_<%= @post.id %>">
      <%= render partial: 'likes/like', locals: {post: @post} %>
    </div>
  </div>
  </div>


  <script type="text/javascript">
    function initMap() {
    var test = {lat: <%= @post.latitude %>, lng: <%= @post.longitude %>};
    var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 15, 
            center: test
            });
    var transitLayer = new google.maps.TransitLayer();
    transitLayer.setMap(map);
    var contentString = '住所：<%= @post.address %>';
    var infowindow = new google.maps.InfoWindow({
    content: contentString
    });
    var marker = new google.maps.Marker({
                position:test,
                map: map,
                title: contentString
              });
    marker.addListener('click', function() {
    infowindow.open(map, marker);
    });
    }
  </script>
  <script async defer
        src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap">
  </script>
  <style type="text/css">
   #map { height: 200px;
      width: 70%;}
  </style>
  <div id="map"></div>

<% if user_signed_in? %>
<% if current_user.id != @post.user_id %>
<div class="comments">
<%= form_with(model: [@post, @comment], local: true) do |f| %>
  <%= f.text_area :content %>
  <br><%= button_tag type: "submit" do %>
    <i class="far fa-comments"></i> コメントする
  <% end %>
<% end %>
<% end %>
</div>
<% end %>


<% if @comments.present? %>
<div class="comment-wrapper">
  <p>コメント一覧</p>
  <% @comments.each do |c| %>
    <div>
      <p><%= c.created_at.strftime("%-m月%-d日") %>
      <%= User.find(c.user_id).nicname %></p>
      <p><%= c.content %><p>
    </div>
  <% end %>
</div>
<% end %>
</div>

</div>



</body>
</html>
